{% extends 'OkaFileBundle::layout.html.twig' %}

{% block title %}{{ parent() }}{% endblock %}

{% block stylesheets %}{{ parent() }}{% endblock %}

{% block body %}
	<div class="row">
		<div class="twelve columns">
			<h3>Enregistrer une nouvelle image</h3>
			<hr>
		</div>
		
		<div class="twelve columns">
			<div class="row">
				<div class="six columns">
					<div class="row">
						{{ form_start(form, {'attr': {'class': 'custom'}}) }}
							<div class="twelve columns">
								{% if form.name.vars.errors is empty %}
									{{ form_widget(form.name, {'attr': {'placeholder': 'Nom de l\'image'}}) }}
								{% else %}
									{{ form_widget(form.name, {'attr': {'placeholder': 'Nom de l\'image', 'class': 'error'}}) }}
									<small class="error">{% for error in form.name.vars.errors %}{{ error.message }}{% if loop.last == false %}<br/>{% endif %}{% endfor %}</small>
								{% endif %}
							</div>
	
							<div class="twelve columns">
								{% if form.uploadedFile.vars.errors is empty %}
									{{ form_widget(form.uploadedFile) }}
								{% else %}
									{{ form_widget(form.uploadedFile, {'attr': {'class': 'error'}}) }}
									<small class="error">{% for error in form.uploadedFile.vars.errors %}{{ error.message }}{% if loop.last == false %}<br/>{% endif %}{% endfor %}</small>
								{% endif %}
							</div>
							
							<div class="twelve columns">
								{{ form_widget(form.save, {'attr': {'class': 'button medium success'}}) }}
							</div>
						{{ form_end(form) }}
					</div>
				</div>
				<div class="six columns">
					<div id="webcam"></div>
					<a href="#" onclick="webcam.capture();">Prendre une photo</a>
					<!-- <a href="javascript:webcam.capture();">Prendre une photo</a> -->
				</div>
			</div>
			<hr> 
		</div>
		
		<div class="twelve columns">
			<a href="{{ path('oka_file_image_list') }}">Retour Ã  la liste</a>
		</div>
	</div>
{% endblock %}

{% block footer %}{{ parent() }}{% endblock %}

{% block javascripts %}
	{{ parent() }}
	<script src="{{ asset('bundles/okafile/js/jQuery-webcam/jquery.webcam.js') }}" type="text/javascript"></script>
	<script type="text/javascript">
		$(document).ready(function(){
			$("#webcam").webcam({
				width: 320,
				height: 240,
				mode: "callback",
				swffile: "{{ asset('bundles/okafile/js/jQuery-webcam/jscam_canvas_only.swf') }}",
// 			    onTick: function(remain) {
// 			        if (0 == remain) {
// 			            jQuery("#status").text("Cheese!");
// 			        } else {
// 			            jQuery("#status").text(remain + " seconds remaining...");
// 			        }
// 			    },
// 			    onSave: function(data) {

// 			        var col = data.split(";");
// 			    // Work with the picture. Picture-data is encoded as an array of arrays... Not really nice, though =/
// 			    },
			    onCapture: function () {
			        webcam.save("{{ path('oka_file_image_snapshot') }}");
// 			        alert('capture');
			    //  Show a flash for example
			    },
// 			    debug: function (type, string) {
// 			        // Write debug information to console.log() or a div, ...
// 			    },
// 			    onLoad: function () {
// 			    // Page load
// 			        var cams = webcam.getCameraList();
// 			        for(var i in cams) {
// 			            jQuery("#cams").append("<li>" + cams[i] + "</li>");
// 			        }
// 			    }
			});
		});
	</script>
{% endblock %}